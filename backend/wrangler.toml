name = "you-plus-consequence-engine"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

[env.production]
name = "you-plus-consequence-engine-prod"

[env.production.vars]
ENVIRONMENT = "production"
DODO_PAYMENTS_ENVIRONMENT = "live_mode"
FRONTEND_URL = "https://getyouplus.com"

[env.staging]
name = "you-plus-consequence-engine-staging"

[env.staging.vars]
ENVIRONMENT = "staging"
DODO_PAYMENTS_ENVIRONMENT = "test_mode"
FRONTEND_URL = "https://staging.getyouplus.com"

# R2 bucket binding for audio file storage
[[r2_buckets]]
binding = "AUDIO_BUCKET"
bucket_name = "youplus-audio-recordings"
preview_bucket_name = "youplus-audio-recordings-dev"

# wrangler.toml (wrangler v3.88.0^)
[observability.logs]
enabled = true


# Daily call scheduling is now handled by AWS EventBridge Scheduler
# Each user gets their own schedule at their preferred call time
# See: /lambda/daily-call-trigger/ and /backend/src/services/scheduler.ts

[vars]
ENVIRONMENT = "development"
BACKEND_URL = "https://you-plus-consequence-engine.rinzhinjalal.workers.dev"

# Development defaults
DODO_PAYMENTS_ENVIRONMENT = "test_mode"
FRONTEND_URL = "http://localhost:3000"

# Secrets to set via wrangler secret put:
# SUPABASE_URL
# SUPABASE_ANON_KEY
# SUPABASE_SERVICE_ROLE_KEY
# BEDROCK_API_KEY (AWS Bedrock API key for OpenAI-compatible API)
# BEDROCK_REGION (AWS Bedrock region, e.g., us-west-2)
#
# LiveKit Configuration (NEW)
# LIVEKIT_API_KEY
# LIVEKIT_API_SECRET
# LIVEKIT_URL
#
# Cartesia Configuration (NEW)
# CARTESIA_API_KEY
#
# Supermemory Configuration (NEW - optional but recommended)
# SUPERMEMORY_API_KEY
#
# DodoPayments Configuration (NEW - required for web billing)
# DODO_PAYMENTS_API_KEY
# DODO_PAYMENTS_WEBHOOK_SECRET
#
# Gemini Configuration (for returning user personalization)
# GEMINI_API_KEY
#
# Legacy Configuration (for backward compatibility)
# ELEVENLABS_API_KEY  (optional - for dual-provider support)
# ELEVENLABS_AGENT_ID  (optional - for legacy calls)
#
# Other Services
# DEEPGRAM_API_KEY
# REVENUECAT_WEBHOOK_SECRET
# IOS_VOIP_KEY_ID
# IOS_VOIP_TEAM_ID
# IOS_VOIP_AUTH_KEY
# DEBUG_ACCESS_TOKEN  (Development only - for secure debug access)
